"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _webpackSources = _interopRequireDefault(require("webpack-sources"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class LooseModeWebpackPlugin {
  constructor(checkLooseMode) {
    this.checkLooseMode = checkLooseMode;
  }

  apply(compiler) {
    compiler.hooks.make.tap('LooseModeWebpackPlugin', compilation => {
      compilation.moduleTemplates.javascript.hooks.render.tap('LooseModeWebpackPlugin', (moduleSource, {
        resource
      }) => {
        const useLooseMode = this.checkLooseMode(resource);

        if (!useLooseMode) {
          return moduleSource;
        }

        const source = moduleSource.source();
        const match = source.match(/['"]use strict['"]/);

        if (!match || match.index === undefined) {
          return moduleSource;
        }

        const replacement = new _webpackSources.default.ReplaceSource(moduleSource);
        replacement.replace(match.index, match.index + match[0].length, '');
        return replacement;
      });
    });
  }

}

exports.default = LooseModeWebpackPlugin;
//# sourceMappingURL=LooseModeWebpackPlugin.js.map