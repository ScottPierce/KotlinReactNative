{"version":3,"sources":["../../src/commands/init.ts"],"names":["delay","time","Promise","resolve","setTimeout","checkProject","progress","cwd","runtime","start","succeed","fail","dedent","logger","enhanceWithModifier","enhanceWithColor","complete","createHaulProjectConfig","preset","overwrite","fs","existsSync","path","join","DEFAULT_CONFIG_FILENAME","inquirer","prompt","type","name","message","config","writeFileSync","modifyBabelConfig","babelPreset","defaultBabelConfigPaths","babelConfigPath","find","filePath","result","validate","pathToFile","entry","babelConfig","readFileSync","toString","replace","relative","modifyXcodeProject","xcodeProject","iosPath","readdirSync","file","includes","project","haulSignature","PROJECTS_COUNT","countOccurrences","search","split","length","info","originalTask","warn","haulTask","RegExp","modifyGradleBuild","gradleBuildFile","androidPath","cliString","getRunScript","scriptName","addHaulScript","packageJson","require","scripts","haulScript","Object","keys","default","assign","JSON","stringify","getAvailableHaulPreset","targetHaulPreset","error","statusCode","previousHaulPreset","match","major","minor","slice","parseInt","installDependencies","haulPreset","useYarn","_","resolved","Boolean","installArgs","concat","stdio","initCommand","command","describe","handler","exitCode","process","rnVersion"],"mappings":"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","sourcesContent":["import {\n  Runtime,\n  getReactNativeVersion,\n  DEFAULT_CONFIG_FILENAME,\n} from '@haul-bundler/core';\nimport ora, { Ora } from 'ora';\nimport fs from 'fs';\nimport path from 'path';\nimport inquirer from 'inquirer';\nimport dedent from 'dedent';\nimport which from 'which';\nimport exec from 'execa';\nimport npmFetch from 'npm-registry-fetch';\n\nconst delay = (time: number) =>\n  new Promise(resolve => setTimeout(resolve, time));\n\nasync function checkProject(progress: Ora, cwd: string, runtime: Runtime) {\n  progress.start('Checking project files');\n  await delay(1000);\n\n  // Are we inside a React Native project?\n  if (getReactNativeVersion(cwd)) {\n    progress.succeed('Project looks good');\n  } else {\n    progress.fail(dedent`\n    This doesn't seem to be a React Native project.\n\n    Make sure you have a ${runtime.logger.enhanceWithModifier(\n      'bold',\n      'package.json'\n    )} file with ${runtime.logger.enhanceWithModifier(\n      'bold',\n      'react-native'\n    )} in dependencies, and you have installed these dependencies.\n\n    To generate a React Native project, run ${runtime.logger.enhanceWithModifier(\n      'bold',\n      'react-native init <ProjectName>'\n    )}. See ${runtime.logger.enhanceWithColor(\n      'cyan',\n      'https://facebook.github.io/react-native/docs/getting-started.html'\n    )} for details.\n  `);\n    runtime.complete(1);\n  }\n}\n\nasync function createHaulProjectConfig(\n  progress: Ora,\n  cwd: string,\n  runtime: Runtime,\n  preset: string\n) {\n  // Does `haul.config.js` already exist?\n  let overwrite = true;\n  if (fs.existsSync(path.join(cwd, DEFAULT_CONFIG_FILENAME))) {\n    overwrite = ((await inquirer.prompt([\n      {\n        type: 'confirm',\n        name: 'overwrite',\n        message: `There is already a '${DEFAULT_CONFIG_FILENAME}'. Overwrite it?`,\n      },\n    ])) as { overwrite: boolean }).overwrite;\n  }\n\n  if (!overwrite) {\n    return;\n  }\n\n  progress.start('Generating config files');\n\n  await delay(1000);\n\n  const config = dedent`\n    import { withPolyfills, makeConfig } from \"${preset}\";\n\n    export default makeConfig({\n      bundles: {\n        index: {\n          entry: withPolyfills('./index'),\n        },\n      },\n    });\n  `;\n\n  fs.writeFileSync(path.join(cwd, DEFAULT_CONFIG_FILENAME), config);\n\n  progress.succeed(\n    `Generated ${runtime.logger.enhanceWithModifier(\n      'bold',\n      DEFAULT_CONFIG_FILENAME\n    )}`\n  );\n}\n\nasync function modifyBabelConfig(\n  progress: Ora,\n  cwd: string,\n  runtime: Runtime,\n  babelPreset: string\n) {\n  progress.start('Updating Babel config');\n\n  const defaultBabelConfigPaths = [\n    path.join(cwd, 'babel.config.js'),\n    path.join(cwd, '.babelrc.js'),\n    path.join(cwd, '.babelrc'),\n  ];\n\n  let babelConfigPath = defaultBabelConfigPaths.find(filePath =>\n    fs.existsSync(filePath)\n  );\n\n  if (!babelConfigPath) {\n    const result = (await inquirer.prompt([\n      {\n        type: 'input',\n        name: 'entry',\n        message: 'Enter path to the Babel config file',\n        validate: (pathToFile: string) =>\n          fs.existsSync(pathToFile) ? true : `${pathToFile} is not a valid`,\n      },\n    ])) as { entry: string };\n\n    babelConfigPath = path.resolve(result.entry);\n  }\n\n  const babelConfig = fs.readFileSync(babelConfigPath).toString();\n  fs.writeFileSync(\n    babelConfigPath,\n    babelConfig.replace('metro-react-native-babel-preset', babelPreset)\n  );\n\n  progress.succeed(\n    `Updated Babel config at ${runtime.logger.enhanceWithModifier(\n      'bold',\n      path.relative(cwd, babelConfigPath)\n    )}`\n  );\n}\n\nasync function modifyXcodeProject(progress: Ora, cwd: string) {\n  let xcodeProject;\n\n  // Does `ios/*.xcodeproj` exist?\n  const iosPath = path.join(cwd, 'ios');\n  if (fs.existsSync(iosPath)) {\n    xcodeProject = fs\n      .readdirSync(iosPath)\n      .find(file => file.includes('.xcodeproj'));\n    xcodeProject = path.join(iosPath, xcodeProject || '');\n  }\n\n  // Otherwise, ask for path to a file\n  if (!xcodeProject) {\n    const result = (await inquirer.prompt([\n      {\n        type: 'input',\n        name: 'entry',\n        message: 'Enter path to the .xcodeproj file',\n        validate: (pathToFile: string) =>\n          fs.existsSync(pathToFile) && pathToFile.includes('.xcodeproj')\n            ? true\n            : `${pathToFile} is not a valid .xcodeproj`,\n      },\n    ])) as { entry: string };\n\n    xcodeProject = path.resolve(result.entry);\n  }\n\n  progress.start('Adding haul to your Xcode build scripts');\n\n  await delay(1000);\n\n  let project = fs\n    .readFileSync(path.join(xcodeProject, 'project.pbxproj'))\n    .toString();\n\n  const haulSignature = 'added by Haul';\n\n  /* Make sure we check both project iOS and iOS-TV, that's the magic behind \"2\" constant */\n\n  const PROJECTS_COUNT = 2;\n\n  const countOccurrences = (search: string) => {\n    return project.split(search).length - 1;\n  };\n\n  // Are we already integrated?\n  if (countOccurrences(haulSignature) === PROJECTS_COUNT) {\n    progress.info('Haul is already part of your build scripts');\n    return;\n  }\n\n  const originalTask = 'shellScript = \"export NODE_BINARY=node';\n\n  if (countOccurrences(originalTask) !== PROJECTS_COUNT) {\n    progress.warn(\n      `Couldn't edit Xcode project. Haven't recognized 'Bundle React Native code and images' build phase.`\n    );\n    return;\n  }\n\n  const haulTask = `shellScript = \"# ${haulSignature}\\\\nexport CLI_PATH=node_modules/@haul-bundler/cli/bin/haul.js\\\\nexport NODE_BINARY=node`;\n\n  project = project.replace(new RegExp(originalTask, 'g'), haulTask);\n\n  fs.writeFileSync(path.join(xcodeProject, 'project.pbxproj'), project);\n  progress.succeed('Added haul to your Xcode build scripts');\n}\n\nasync function modifyGradleBuild(progress: Ora, cwd: string) {\n  let gradleBuildFile;\n  // Does `android/app/build.gradle` exist?\n  const androidPath = path.join(cwd, 'android/app');\n  if (fs.existsSync(androidPath)) {\n    gradleBuildFile = fs\n      .readdirSync(androidPath)\n      .find(file => file.includes('build.gradle'));\n    gradleBuildFile = path.join(androidPath, gradleBuildFile || '');\n  }\n  // Otherwise, ask for path to a file\n  if (!gradleBuildFile) {\n    const result = (await inquirer.prompt([\n      {\n        type: 'input',\n        name: 'entry',\n        message: 'Enter path to the android/app/build.gradle file',\n        validate: (pathToFile: string) =>\n          fs.existsSync(pathToFile) && pathToFile.includes('build.gradle')\n            ? true\n            : `${pathToFile} is not a valid build.gradle`,\n      },\n    ])) as { entry: string };\n    gradleBuildFile = path.resolve(result.entry);\n  }\n  progress.start('Adding haul to your build.gradle');\n  await delay(1000);\n  let project = fs.readFileSync(gradleBuildFile).toString();\n  const cliString = '\"node_modules/@haul-bundler/cli/bin/haul.js\"';\n\n  // Are we already integrated?\n  if (project.includes(cliString)) {\n    progress.info('Haul is already part of your build.gradle');\n    return;\n  }\n\n  project = project.replace(\n    /project\\.ext\\.react = \\[\\n([^\\]]+)\\n\\]/,\n    dedent`\n    project.ext.react = [\n    $1,\n        cliPath: ${cliString}\n    ]\n    `\n  );\n  fs.writeFileSync(gradleBuildFile, project);\n  progress.succeed('Added haul to your build.gradle');\n}\n\nfunction getRunScript(scriptName: string) {\n  return `yarn run ${scriptName}`;\n}\n\nasync function addHaulScript(progress: Ora, cwd: string): Promise<string> {\n  const packageJson = require(path.join(cwd, 'package.json'));\n  const scripts = packageJson.scripts || {};\n  const haulScript = Object.keys(scripts).find(\n    name => scripts[name] === 'haul'\n  );\n\n  if (haulScript) {\n    progress.info('Haul already exists in your package.json.');\n    return haulScript;\n  }\n\n  let scriptName = 'start';\n  if (\n    scripts.start &&\n    scripts.start !== 'node node_modules/react-native/local-cli/cli.js start'\n  ) {\n    const result = (await inquirer.prompt([\n      {\n        type: 'input',\n        name: 'scriptName',\n        message:\n          'Enter the name of the script to add to package.json, e.g. `haul` for `yarn run haul`',\n        default: 'haul',\n      },\n    ])) as { scriptName: string };\n\n    scriptName = result.scriptName;\n  }\n\n  packageJson.scripts = Object.assign({}, scripts, {\n    [scriptName]: 'haul start',\n  });\n\n  progress.start(`Adding \\`${scriptName}\\` script to your package.json`);\n\n  await delay(1000);\n\n  fs.writeFileSync(\n    path.join(cwd, 'package.json'),\n    JSON.stringify(packageJson, null, 2)\n  );\n\n  return scriptName;\n}\n\nasync function getAvailableHaulPreset(\n  progress: Ora,\n  targetHaulPreset: string\n): Promise<string> {\n  // Stop searching on 0.59 - there's no preset below 0.59.\n  if (targetHaulPreset.includes('0.59')) {\n    return targetHaulPreset;\n  }\n\n  try {\n    await npmFetch(targetHaulPreset);\n    return targetHaulPreset;\n  } catch (error) {\n    if (error.statusCode === 404) {\n      progress.info(\n        `${targetHaulPreset} not available. Trying older version...`\n      );\n      const previousHaulPreset = targetHaulPreset.replace(/-0\\.\\d+$/, match => {\n        const [major, minor] = match.slice(1).split('.');\n        return `-${major}.${parseInt(minor, 10) - 1}`;\n      });\n      return await getAvailableHaulPreset(progress, previousHaulPreset);\n    }\n\n    return targetHaulPreset;\n  }\n}\n\nasync function installDependencies(\n  progress: Ora,\n  { babelPreset, haulPreset }: { babelPreset: string; haulPreset: string }\n) {\n  progress.info('Installing required devDependencies');\n\n  const useYarn = await new Promise<boolean>(resolve => {\n    which('yarn', (_, resolved: string | undefined) => {\n      resolve(Boolean(resolved));\n    });\n  });\n  const installArgs = (useYarn\n    ? ['add', '-D']\n    : ['install', '--save-dev']\n  ).concat(babelPreset, haulPreset);\n  await exec(useYarn ? 'yarn' : 'npm', installArgs, { stdio: 'inherit' });\n}\n\nexport default function initCommand(runtime: Runtime) {\n  return {\n    command: 'init',\n    describe: 'Generates necessary configuration files',\n    async handler() {\n      let exitCode = 0;\n      try {\n        const cwd = process.cwd();\n        const rnVersion = getReactNativeVersion(cwd);\n\n        if (!rnVersion) {\n          runtime.logger.error(\n            'Cannot find React Native. Are you in React Native project?'\n          );\n          runtime.complete(1);\n        }\n\n        const progress = ora().start('Detecting Haul preset version...');\n\n        const babelPreset = '@haul-bundler/babel-preset-react-native';\n        const haulPreset = await getAvailableHaulPreset(\n          progress,\n          `@haul-bundler/preset-${rnVersion!.major}.${rnVersion!.minor}`\n        );\n\n        progress.info(`Using Haul preset: ${haulPreset}`);\n\n        await checkProject(progress, cwd, runtime);\n        await createHaulProjectConfig(progress, cwd, runtime, haulPreset);\n        await modifyBabelConfig(progress, cwd, runtime, babelPreset);\n        await modifyXcodeProject(progress, cwd);\n        await modifyGradleBuild(progress, cwd);\n        const scriptName = await addHaulScript(progress, cwd);\n        await installDependencies(progress, { babelPreset, haulPreset });\n        progress.succeed(\n          `You can now start Haul by running '${getRunScript(scriptName)}'`\n        );\n      } catch (error) {\n        runtime.logger.error('Command failed with error:', error);\n        exitCode = 1;\n      } finally {\n        runtime.complete(exitCode);\n      }\n    },\n  };\n}\n"],"file":"init.js"}